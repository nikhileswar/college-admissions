<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CollegeMatch â€” JEE Advanced 2025</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â”€â”€ Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --bg: #080c18;
  --surface: #0f1624;
  --surface2: #161f30;
  --surface3: #1e2a40;
  --border: #263448;
  --accent: #4f9cf0;
  --accent-dim: rgba(79,156,240,0.15);
  --gold: #e8a838;
  --gold-dim: rgba(232,168,56,0.15);
  --green: #6ee7b7;
  --green-dim: rgba(110,231,183,0.12);
  --red: #f87171;
  --red-dim: rgba(248,113,113,0.12);
  --purple: #a78bfa;
  --text: #e2e8f4;
  --muted: #7a8fa8;
  --radius: 12px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

/* â”€â”€ Login Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#login-screen {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
  background:
    radial-gradient(ellipse at 15% 25%, rgba(79,156,240,0.10) 0%, transparent 55%),
    radial-gradient(ellipse at 85% 75%, rgba(167,139,250,0.07) 0%, transparent 55%),
    var(--bg);
}
.login-box {
  width: 100%;
  max-width: 440px;
}
.login-logo {
  font-family: 'DM Serif Display', serif;
  font-size: 2.4rem;
  letter-spacing: -0.03em;
  margin-bottom: 4px;
  text-align: center;
}
.login-logo span { color: var(--accent); }
.login-subtitle {
  text-align: center;
  color: var(--muted);
  font-size: 0.9rem;
  margin-bottom: 40px;
}
.login-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 32px;
  margin-bottom: 16px;
}
.login-role-tabs {
  display: flex;
  gap: 0;
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 28px;
}
.login-role-tab {
  flex: 1;
  padding: 10px;
  text-align: center;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  border: none;
  background: transparent;
  color: var(--muted);
  font-family: 'Outfit', sans-serif;
  transition: all 0.2s;
}
.login-role-tab.active { background: var(--accent); color: #fff; }
.login-role-tab:not(.active):hover { background: var(--surface2); color: var(--text); }

.login-field { margin-bottom: 20px; }
.login-field label {
  display: block;
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 8px;
}
.login-field input, .login-field select {
  width: 100%;
  padding: 12px 16px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  font-size: 0.95rem;
  outline: none;
  transition: border-color 0.2s;
}
.login-field input:focus, .login-field select:focus { border-color: var(--accent); }
.login-field select option { background: var(--surface2); }
.login-btn {
  width: 100%;
  padding: 13px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-family: 'Outfit', sans-serif;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  letter-spacing: 0.01em;
}
.login-btn:hover { background: #3b8de0; transform: translateY(-1px); }
.login-error {
  background: var(--red-dim);
  border: 1px solid rgba(248,113,113,0.25);
  color: var(--red);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 0.85rem;
  margin-bottom: 16px;
  display: none;
}
.demo-hint {
  text-align: center;
  font-size: 0.8rem;
  color: var(--muted);
  padding: 0 8px;
}
.demo-hint strong { color: var(--gold); }

/* â”€â”€ App Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app { display: none; }

header {
  padding: 0 32px;
  height: 60px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: rgba(15,22,36,0.95);
  backdrop-filter: blur(12px);
  position: sticky;
  top: 0;
  z-index: 100;
}
.logo {
  font-family: 'DM Serif Display', serif;
  font-size: 1.3rem;
  letter-spacing: -0.02em;
}
.logo span { color: var(--accent); }
.header-right { display: flex; align-items: center; gap: 16px; }
.user-badge {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 0.82rem;
}
.user-badge .role-dot {
  width: 7px; height: 7px; border-radius: 50%;
}
.role-dot.admin { background: var(--gold); }
.role-dot.student { background: var(--green); }

.nav-tabs {
  display: flex;
  gap: 2px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 3px;
}
.nav-tab {
  padding: 6px 16px;
  border: none;
  background: transparent;
  color: var(--muted);
  font-family: 'Outfit', sans-serif;
  font-size: 0.82rem;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}
.nav-tab.active { background: var(--accent); color: #fff; }
.nav-tab:hover:not(.active) { color: var(--text); background: var(--surface3); }
.logout-btn {
  padding: 6px 14px;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--muted);
  border-radius: 8px;
  font-family: 'Outfit', sans-serif;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
}
.logout-btn:hover { border-color: var(--red); color: var(--red); }

main { max-width: 960px; margin: 0 auto; padding: 36px 24px; }

/* â”€â”€ Pages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page { display: none; animation: fadeUp 0.25s ease; }
.page.active { display: block; }
@keyframes fadeUp { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:none; } }

h1 {
  font-family: 'DM Serif Display', serif;
  font-size: 2rem;
  letter-spacing: -0.025em;
  margin-bottom: 6px;
  line-height: 1.2;
}
h2 {
  font-family: 'DM Serif Display', serif;
  font-size: 1.35rem;
  margin-bottom: 14px;
}
.subtitle { color: var(--muted); font-size: 0.9rem; margin-bottom: 28px; line-height: 1.5; }

/* â”€â”€ Cards / Components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px;
  margin-bottom: 16px;
}
.info-box {
  background: var(--accent-dim);
  border: 1px solid rgba(79,156,240,0.2);
  border-radius: 8px;
  padding: 12px 16px;
  font-size: 0.875rem;
  color: var(--muted);
  margin-bottom: 20px;
  line-height: 1.6;
}
.info-box strong { color: var(--accent); }
.notice {
  padding: 12px 16px;
  border-radius: 8px;
  font-size: 0.875rem;
  margin-bottom: 14px;
}
.notice.success { background: var(--green-dim); border: 1px solid rgba(110,231,183,0.25); color: var(--green); }
.notice.warning { background: var(--gold-dim); border: 1px solid rgba(232,168,56,0.25); color: var(--gold); }
.notice.error   { background: var(--red-dim);  border: 1px solid rgba(248,113,113,0.25); color: var(--red); }

label {
  display: block;
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 8px;
}
input[type="text"], input[type="number"], input[type="password"], select {
  width: 100%;
  padding: 10px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  font-size: 0.9rem;
  outline: none;
  transition: border-color 0.2s;
}
input:focus, select:focus { border-color: var(--accent); }
select option { background: var(--surface2); }
.row { display: flex; gap: 12px; align-items: flex-end; }
.row > * { flex: 1; }
.row > .shrink { flex: 0 0 auto; }

.btn {
  padding: 9px 18px;
  border: none;
  border-radius: 8px;
  font-family: 'Outfit', sans-serif;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover { background: #3b8de0; transform: translateY(-1px); }
.btn-secondary { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
.btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
.btn-danger { background: transparent; color: var(--red); border: 1px solid var(--border); }
.btn-danger:hover { border-color: var(--red); background: var(--red-dim); }
.btn-success { background: var(--green); color: #061a0e; font-weight: 700; }
.btn-success:hover { background: #5dd4a2; transform: translateY(-1px); }
.btn-gold { background: var(--gold); color: #1a0f00; font-weight: 700; }
.btn-gold:hover { background: #d49a2c; transform: translateY(-1px); }

.pill {
  display: inline-block;
  padding: 2px 10px;
  border-radius: 20px;
  font-size: 0.72rem;
  font-weight: 700;
  letter-spacing: 0.02em;
}
.pill-blue   { background: var(--accent-dim); color: var(--accent); }
.pill-green  { background: var(--green-dim);  color: var(--green);  }
.pill-yellow { background: var(--gold-dim);   color: var(--gold);   }
.pill-red    { background: var(--red-dim);    color: var(--red);    }
.pill-purple { background: rgba(167,139,250,0.15); color: var(--purple); }

.tag {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 3px 10px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 0.78rem;
  font-family: 'DM Mono', monospace;
}
.tag .remove { cursor: pointer; color: var(--muted); transition: color 0.15s; }
.tag .remove:hover { color: var(--red); }
.tag-list { display: flex; flex-wrap: wrap; gap: 8px; }

.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 12px;
  margin-bottom: 24px;
}
.stat-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 20px;
}
.stat-val {
  font-family: 'DM Serif Display', serif;
  font-size: 1.9rem;
  color: var(--accent);
  line-height: 1;
  margin-bottom: 4px;
}
.stat-lbl { font-size: 0.72rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }

.branch-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 11px 15px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-bottom: 7px;
  font-size: 0.85rem;
}
.branch-key { color: var(--accent); font-weight: 600; font-family: 'DM Mono', monospace; }

/* Pref drag list */
.pref-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 14px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-bottom: 6px;
  cursor: grab;
  transition: all 0.15s;
  user-select: none;
}
.pref-row:hover { border-color: var(--accent); background: var(--surface3); }
.pref-row.dragging { opacity: 0.4; border-color: var(--accent); }
.pref-rank { font-family: 'DM Mono', monospace; font-size: 0.72rem; color: var(--gold); font-weight: 700; min-width: 26px; }
.pref-name { flex: 1; font-size: 0.88rem; }
.drag-handle { color: var(--muted); font-size: 1rem; }

/* Results */
.result-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 10px;
}
.result-header {
  padding: 14px 20px;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.result-college { font-family: 'DM Serif Display', serif; font-size: 1.05rem; }
.result-branch { font-family: 'DM Mono', monospace; font-size: 0.78rem; color: var(--accent); margin-top: 2px; }
.result-students { padding: 14px 20px; display: flex; flex-wrap: wrap; gap: 8px; }
.student-chip {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.78rem;
  font-family: 'DM Mono', monospace;
}
.student-chip.matched  { background: var(--green-dim);  border: 1px solid rgba(110,231,183,0.25); color: var(--green); }
.student-chip.unmatched{ background: var(--red-dim);    border: 1px solid rgba(248,113,113,0.2);  color: var(--red); }
.empty { color: var(--muted); font-size: 0.85rem; font-style: italic; padding: 8px 0; }

/* Student-portal allotment banner */
.allotment-banner {
  border-radius: var(--radius);
  padding: 28px 28px;
  margin-bottom: 20px;
  position: relative;
  overflow: hidden;
}
.allotment-banner.matched-banner {
  background: linear-gradient(135deg, rgba(110,231,183,0.12), rgba(79,156,240,0.08));
  border: 1px solid rgba(110,231,183,0.3);
}
.allotment-banner.unmatched-banner {
  background: var(--red-dim);
  border: 1px solid rgba(248,113,113,0.25);
}
.allotment-banner.pending-banner {
  background: var(--gold-dim);
  border: 1px solid rgba(232,168,56,0.25);
}
.allotment-label { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; margin-bottom: 8px; }
.allotment-college { font-family: 'DM Serif Display', serif; font-size: 1.7rem; line-height: 1.15; margin-bottom: 4px; }
.allotment-branch { font-family: 'DM Mono', monospace; font-size: 0.9rem; color: var(--accent); }
.allotment-rank { font-size: 0.82rem; color: var(--muted); margin-top: 10px; }

/* Admin student prefs table */
.admin-pref-table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
.admin-pref-table th {
  padding: 9px 14px;
  text-align: left;
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--muted);
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  font-weight: 600;
}
.admin-pref-table td {
  padding: 9px 14px;
  border-bottom: 1px solid var(--border);
  vertical-align: top;
}
.admin-pref-table tr:last-child td { border-bottom: none; }
.admin-pref-table tr:hover td { background: var(--surface2); }
.student-name-cell { font-weight: 600; white-space: nowrap; }
.pref-mini { font-family: 'DM Mono', monospace; font-size: 0.75rem; color: var(--muted); line-height: 1.6; }
.pref-mini span.top { color: var(--accent); }

/* Search */
.search-box {
  position: relative;
  margin-bottom: 16px;
}
.search-box input {
  padding-left: 36px;
}
.search-box::before {
  content: 'ğŸ”';
  position: absolute;
  left: 11px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 0.8rem;
  pointer-events: none;
}

/* Sep */
hr.sep { border: none; border-top: 1px solid var(--border); margin: 22px 0; }

@media (max-width:640px) {
  header { padding: 0 16px; flex-wrap: wrap; height: auto; padding: 12px 16px; gap: 10px; }
  .nav-tabs .nav-tab { padding: 5px 10px; font-size: 0.75rem; }
  main { padding: 20px 14px; }
  h1 { font-size: 1.6rem; }
  .row { flex-direction: column; }
  .stats-row { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">College<span>Match</span></div>
    <div class="login-subtitle">JEE Advanced 2025 â€” Stable Matching System</div>

    <div class="login-card">
      <div class="login-role-tabs">
        <button class="login-role-tab active" onclick="switchLoginRole('student')" id="tab-student">ğŸ“ Student Login</button>
        <button class="login-role-tab" onclick="switchLoginRole('admin')" id="tab-admin">âš™ Admin Login</button>
      </div>

      <div id="login-error" class="login-error"></div>

      <!-- Student login -->
      <div id="student-login-form">
        <div class="login-field">
          <label>Select Your Name (AIR Rank)</label>
          <select id="sl-name">
            <option value="">â€” Choose your name â€”</option>
          </select>
        </div>
        <div class="login-field">
          <label>Password</label>
          <input type="password" id="sl-pass" placeholder="Enter your password" onkeydown="if(event.key==='Enter')doLogin()" />
        </div>
        <button class="login-btn" onclick="doLogin()">Login as Student â†’</button>
      </div>

      <!-- Admin login -->
      <div id="admin-login-form" style="display:none">
        <div class="login-field">
          <label>Admin Username</label>
          <input type="text" id="al-user" placeholder="admin" value="admin" />
        </div>
        <div class="login-field">
          <label>Password</label>
          <input type="password" id="al-pass" placeholder="Enter admin password" onkeydown="if(event.key==='Enter')doLogin()" />
        </div>
        <button class="login-btn" onclick="doLogin()">Login as Admin â†’</button>
      </div>
    </div>

    <div class="demo-hint">
      Demo passwords â€” Student: <strong>jee2025</strong> &nbsp;|&nbsp; Admin: <strong>admin123</strong><br>
      Load demo data first from the Admin panel after logging in.
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <header>
    <div class="logo">College<span>Match</span></div>
    <nav class="nav-tabs" id="nav-tabs"></nav>
    <div class="header-right">
      <div class="user-badge">
        <div class="role-dot" id="role-dot"></div>
        <span id="user-label"></span>
      </div>
      <button class="logout-btn" onclick="logout()">Sign out</button>
    </div>
  </header>

  <main>
    <!-- â”€â”€ ADMIN: Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-admin-setup">
      <h1>System Setup</h1>
      <p class="subtitle">Configure colleges, branches, and the student roster.</p>
      <div class="stats-row" id="admin-stats"></div>

      <div class="card">
        <h2>Colleges & Branches</h2>
        <div class="info-box">Add each <strong>college + branch</strong> combination with seat capacity. Students will rank these pairs.</div>
        <div class="row">
          <div><label>College</label><input type="text" id="in-college" placeholder="IIT Bombay" /></div>
          <div><label>Branch</label><input type="text" id="in-branch" placeholder="Computer Science & Engg" /></div>
          <div style="flex:0 0 110px"><label>Seats</label><input type="number" id="in-seats" value="5" min="1" max="500" /></div>
          <div class="shrink"><button class="btn btn-primary" onclick="addBranch()">+ Add</button></div>
        </div>
        <div id="branch-list" style="margin-top:14px"></div>
      </div>

      <div class="card">
        <h2>Student Roster</h2>
        <div class="info-box">Each student added here can log in with the password <strong>jee2025</strong>. You can change the default password below.</div>
        <div class="row" style="margin-bottom:12px">
          <div><label>Default Student Password</label><input type="text" id="in-default-pass" value="jee2025" /></div>
        </div>
        <div class="row">
          <div><label>Student Name / ID</label><input type="text" id="in-student" placeholder="Rajit Gupta" onkeydown="if(event.key==='Enter')addStudent()" /></div>
          <div class="shrink"><button class="btn btn-primary" onclick="addStudent()">+ Add</button></div>
        </div>
        <div id="student-tag-list" class="tag-list" style="margin-top:14px"></div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btn-gold" onclick="loadDemo()">ğŸ“‹ Load JEE 2025 Demo</button>
        <button class="btn btn-danger" onclick="resetAll()">ğŸ—‘ Reset Everything</button>
      </div>
    </div>

    <!-- â”€â”€ ADMIN: All Student Preferences â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-admin-prefs">
      <h1>Student Preferences</h1>
      <p class="subtitle">View all students' submitted preference lists and submission status.</p>

      <div class="stats-row" id="prefs-stats"></div>

      <div class="card">
        <div class="search-box">
          <input type="text" id="prefs-search" placeholder="Search student nameâ€¦" oninput="renderAdminPrefs()" />
        </div>
        <div style="overflow-x:auto">
          <table class="admin-pref-table">
            <thead>
              <tr>
                <th>Student</th>
                <th>Status</th>
                <th>Top 5 Preferences</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="prefs-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€ ADMIN: Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-admin-results">
      <h1>Matching Results</h1>
      <p class="subtitle">Gale-Shapley stable matching â€” student-optimal allocation.</p>
      <button class="btn btn-gold" onclick="runMatching()" style="margin-bottom:24px">âš¡ Run Stable Matching</button>
      <div id="results-output"></div>
    </div>

    <!-- â”€â”€ STUDENT: My Preferences â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-student-prefs">
      <h1 id="student-page-title">My Preferences</h1>
      <p class="subtitle">Drag to reorder your college-branch preferences. Submit when done.</p>

      <div class="info-box">
        <strong>How to use:</strong> Drag the rows to set your preferred order. Rank #1 = most preferred. Click <strong>Save & Submit</strong> when you're ready â€” you can update until the admin runs the matching.
      </div>

      <div id="student-pref-card" class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
          <h2 style="margin:0">Preference List</h2>
          <span id="student-pref-pill"></span>
        </div>
        <p style="font-size:0.82rem;color:var(--muted);margin-bottom:14px">â ¿ Drag rows to reorder &nbsp;Â·&nbsp; Rank 1 = most preferred</p>
        <div id="student-pref-list"></div>
        <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn btn-success" onclick="studentSavePrefs()">âœ“ Save & Submit</button>
          <button class="btn btn-secondary" onclick="studentResetPrefs()">â†º Reset to Default</button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ STUDENT: My Allotment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-student-allotment">
      <h1>My Allotment</h1>
      <p class="subtitle">Your seat allocation based on the stable matching result.</p>
      <div id="student-allotment-content"></div>
    </div>
  </main>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = {
  branches:  [],   // [{id, college, branch, seats}]
  students:  [],   // [{id, name, password}]
  prefs:     {},   // {studentId: [branchId, ...]}
  submitted: {},   // {studentId: bool}
  matching:  null, // {slotHolders:{branchId:[studentId,...]}} or null
  adminPass: 'admin123',
};

let session = null; // {role:'admin'} | {role:'student', sid:string}

function save() { localStorage.setItem('cm2_state', JSON.stringify(state)); }
function loadState() {
  const d = localStorage.getItem('cm2_state');
  if (d) state = { ...state, ...JSON.parse(d) };
}
loadState();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOGIN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let loginRole = 'student';

function switchLoginRole(role) {
  loginRole = role;
  document.getElementById('tab-student').classList.toggle('active', role==='student');
  document.getElementById('tab-admin').classList.toggle('active', role==='admin');
  document.getElementById('student-login-form').style.display = role==='student' ? '' : 'none';
  document.getElementById('admin-login-form').style.display   = role==='admin'   ? '' : 'none';
  document.getElementById('login-error').style.display = 'none';
}

function populateStudentSelect() {
  const sel = document.getElementById('sl-name');
  sel.innerHTML = '<option value="">â€” Choose your name â€”</option>' +
    state.students.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
}

function showLoginError(msg) {
  const el = document.getElementById('login-error');
  el.textContent = msg;
  el.style.display = 'block';
}

function doLogin() {
  document.getElementById('login-error').style.display = 'none';
  if (loginRole === 'admin') {
    const user = document.getElementById('al-user').value.trim();
    const pass = document.getElementById('al-pass').value;
    if (user === 'admin' && pass === state.adminPass) {
      session = { role: 'admin' };
      enterApp();
    } else {
      showLoginError('Invalid admin credentials. Default password: admin123');
    }
  } else {
    const sid = document.getElementById('sl-name').value;
    const pass = document.getElementById('sl-pass').value;
    if (!sid) return showLoginError('Please select your name.');
    const student = state.students.find(s => s.id === sid);
    if (!student) return showLoginError('Student not found.');
    if (pass !== student.password) return showLoginError('Incorrect password. Default: jee2025');
    session = { role: 'student', sid };
    enterApp();
  }
}

function logout() {
  session = null;
  document.getElementById('app').style.display = 'none';
  document.getElementById('login-screen').style.display = 'flex';
  populateStudentSelect();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  APP ENTRY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enterApp() {
  document.getElementById('login-screen').style.display = 'none';
  document.getElementById('app').style.display = 'block';

  const dot = document.getElementById('role-dot');
  const lbl = document.getElementById('user-label');

  if (session.role === 'admin') {
    dot.className = 'role-dot admin';
    lbl.textContent = 'Admin';
    buildNav([
      { id:'admin-setup',   label:'âš™ Setup' },
      { id:'admin-prefs',   label:'ğŸ“‹ All Preferences' },
      { id:'admin-results', label:'ğŸ“ Results' },
    ]);
    showPage('admin-setup');
    renderAdmin();
  } else {
    const student = state.students.find(s => s.id === session.sid);
    dot.className = 'role-dot student';
    lbl.textContent = student ? student.name.split(' ')[0] : 'Student';
    document.getElementById('student-page-title').textContent = 'My Preferences';
    buildNav([
      { id:'student-prefs',     label:'ğŸ“ My Preferences' },
      { id:'student-allotment', label:'ğŸ“ My Allotment' },
    ]);
    showPage('student-prefs');
    renderStudentPrefs();
  }
}

function buildNav(tabs) {
  const nav = document.getElementById('nav-tabs');
  nav.innerHTML = tabs.map(t =>
    `<button class="nav-tab" data-page="${t.id}" onclick="showPage('${t.id}')">${t.label}</button>`
  ).join('');
}

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  const pg = document.getElementById('page-' + id);
  if (pg) pg.classList.add('active');
  const tab = document.querySelector(`.nav-tab[data-page="${id}"]`);
  if (tab) tab.classList.add('active');

  if (id === 'admin-setup')   renderAdmin();
  if (id === 'admin-prefs')   renderAdminPrefs();
  if (id === 'student-prefs') renderStudentPrefs();
  if (id === 'student-allotment') renderStudentAllotment();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN: SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAdmin() {
  const totalSeats = state.branches.reduce((a,b) => a+b.seats, 0);
  const submitted  = Object.values(state.submitted).filter(Boolean).length;
  document.getElementById('admin-stats').innerHTML = `
    <div class="stat-box"><div class="stat-val">${state.branches.length}</div><div class="stat-lbl">Branch Slots</div></div>
    <div class="stat-box"><div class="stat-val">${totalSeats}</div><div class="stat-lbl">Total Seats</div></div>
    <div class="stat-box"><div class="stat-val">${state.students.length}</div><div class="stat-lbl">Students</div></div>
    <div class="stat-box"><div class="stat-val">${submitted}<span style="font-size:1rem;color:var(--muted)">/${state.students.length}</span></div><div class="stat-lbl">Prefs Submitted</div></div>
  `;

  const bl = document.getElementById('branch-list');
  bl.innerHTML = !state.branches.length ? '<div class="empty">No branches added yet.</div>' :
    state.branches.map(b => `
      <div class="branch-item">
        <span><span class="branch-key">${b.college}</span> â€” ${b.branch}</span>
        <span style="display:flex;align-items:center;gap:10px">
          <span style="color:var(--muted);font-size:0.8rem">${b.seats} seats</span>
          <button class="btn btn-danger" style="padding:3px 9px;font-size:0.72rem" onclick="removeBranch('${b.id}')">âœ•</button>
        </span>
      </div>`).join('');

  const sl = document.getElementById('student-tag-list');
  sl.innerHTML = !state.students.length ? '<div class="empty">No students yet.</div>' :
    state.students.map(s => `
      <div class="tag">${s.name}
        <span class="remove" onclick="removeStudent('${s.id}')">Ã—</span>
      </div>`).join('');
}

function uid() { return Math.random().toString(36).slice(2,8); }
function branchLabel(b) { return `${b.college} â€” ${b.branch}`; }

function addBranch() {
  const c = document.getElementById('in-college').value.trim();
  const b = document.getElementById('in-branch').value.trim();
  const s = parseInt(document.getElementById('in-seats').value)||1;
  if (!c||!b) return alert('Enter college and branch.');
  const nb = {id:uid(), college:c, branch:b, seats:s};
  state.branches.push(nb);
  state.students.forEach(st => { if(state.prefs[st.id]) state.prefs[st.id].push(nb.id); });
  document.getElementById('in-branch').value = '';
  save(); renderAdmin();
}

function removeBranch(id) {
  state.branches = state.branches.filter(b=>b.id!==id);
  Object.keys(state.prefs).forEach(sid => { state.prefs[sid]=(state.prefs[sid]||[]).filter(bid=>bid!==id); });
  state.matching = null;
  save(); renderAdmin();
}

function addStudent() {
  const n = document.getElementById('in-student').value.trim();
  const pass = document.getElementById('in-default-pass').value.trim() || 'jee2025';
  if (!n) return alert('Enter a student name.');
  if (state.students.find(s=>s.name.toLowerCase()===n.toLowerCase())) return alert('Student already exists.');
  const s = {id:uid(), name:n, password:pass};
  state.students.push(s);
  state.prefs[s.id] = state.branches.map(b=>b.id);
  state.submitted[s.id] = false;
  document.getElementById('in-student').value = '';
  save(); renderAdmin(); populateStudentSelect();
}

function removeStudent(id) {
  state.students = state.students.filter(s=>s.id!==id);
  delete state.prefs[id]; delete state.submitted[id];
  state.matching = null;
  save(); renderAdmin(); populateStudentSelect();
}

function resetAll() {
  if (!confirm('Clear all data?')) return;
  state = {...state, branches:[], students:[], prefs:{}, submitted:{}, matching:null};
  save(); renderAdmin();
  document.getElementById('results-output').innerHTML='';
  populateStudentSelect();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN: ALL STUDENT PREFERENCES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAdminPrefs() {
  const sub = Object.values(state.submitted).filter(Boolean).length;
  document.getElementById('prefs-stats').innerHTML = `
    <div class="stat-box"><div class="stat-val">${state.students.length}</div><div class="stat-lbl">Total Students</div></div>
    <div class="stat-box"><div class="stat-val" style="color:var(--green)">${sub}</div><div class="stat-lbl">Submitted</div></div>
    <div class="stat-box"><div class="stat-val" style="color:var(--gold)">${state.students.length-sub}</div><div class="stat-lbl">Pending</div></div>
  `;

  const q = (document.getElementById('prefs-search')||{value:''}).value.toLowerCase();
  const filtered = state.students.filter(s => s.name.toLowerCase().includes(q));
  const tbody = document.getElementById('prefs-tbody');

  if (!filtered.length) { tbody.innerHTML = `<tr><td colspan="4" class="empty" style="padding:20px">No students found.</td></tr>`; return; }

  tbody.innerHTML = filtered.map(s => {
    const done = state.submitted[s.id];
    const prefs = state.prefs[s.id] || [];
    const top5 = prefs.slice(0,5).map((bid,i) => {
      const b = state.branches.find(x=>x.id===bid);
      if(!b) return '';
      return `<span class="pref-mini"><span class="${i<3?'top':''}">#${i+1}</span> ${b.college} â€” ${b.branch}</span>`;
    }).join('<br>');
    return `
      <tr>
        <td class="student-name-cell">${s.name}</td>
        <td><span class="pill ${done?'pill-green':'pill-yellow'}">${done?'âœ“ Submitted':'Pending'}</span></td>
        <td><div style="line-height:1.8">${top5 || '<span style="color:var(--muted);font-size:0.78rem">No prefs yet</span>'}</div></td>
        <td>
          <button class="btn btn-secondary" style="padding:4px 10px;font-size:0.75rem" onclick="adminViewFullPrefs('${s.id}')">View All</button>
        </td>
      </tr>`;
  }).join('');
}

function adminViewFullPrefs(sid) {
  const s = state.students.find(x=>x.id===sid);
  const prefs = state.prefs[sid]||[];
  const lines = prefs.map((bid,i) => {
    const b = state.branches.find(x=>x.id===bid);
    return b ? `#${i+1}. ${b.college} â€” ${b.branch}` : '';
  }).filter(Boolean).join('\n');
  alert(`${s.name}'s full preference list:\n\n${lines}`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMIN: GALE-SHAPLEY MATCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function runMatching() {
  if (!state.branches.length||!state.students.length) {
    document.getElementById('results-output').innerHTML='<div class="notice error">Add colleges and students first.</div>'; return;
  }
  const out = document.getElementById('results-output');
  const unsubmitted = state.students.filter(s=>!state.submitted[s.id]);
  out.innerHTML = unsubmitted.length
    ? `<div class="notice warning">âš  ${unsubmitted.length} student(s) haven't submitted preferences â€” using default order for them.</div>`
    : '';

  // Gale-Shapley (student-proposing)
  const propIdx = {}; state.students.forEach(s=>propIdx[s.id]=0);
  const slots = {}; state.branches.forEach(b=>slots[b.id]=[]);
  const colRank = {}; // college preference = student roster index (lower = preferred)
  state.branches.forEach(b => {
    colRank[b.id]={};
    state.students.forEach((s,i)=>colRank[b.id][s.id]=i);
  });

  let free = state.students.map(s=>s.id);
  const maxIt = state.students.length * state.branches.length + 10;
  let it=0;
  while(free.length&&it<maxIt) {
    it++;
    const sid=free.shift();
    const prefs=state.prefs[sid]||state.branches.map(b=>b.id);
    if(propIdx[sid]>=prefs.length) continue;
    const bid=prefs[propIdx[sid]++];
    const branch=state.branches.find(b=>b.id===bid);
    if(!branch){free.push(sid);continue;}
    const h=slots[bid];
    if(h.length<branch.seats){h.push(sid);}
    else {
      let worst=h[0];
      h.forEach(x=>{if(colRank[bid][x]>colRank[bid][worst])worst=x;});
      if(colRank[bid][sid]<colRank[bid][worst]){
        slots[bid]=h.filter(x=>x!==worst); slots[bid].push(sid); free.push(worst);
      } else { free.push(sid); }
    }
  }

  state.matching = {slotHolders: slots};
  save();

  const matchedSet = new Set(Object.values(slots).flat());
  const unmatched = state.students.filter(s=>!matchedSet.has(s.id));
  const matchedCount = matchedSet.size;

  out.innerHTML += `
    <div class="stats-row">
      <div class="stat-box"><div class="stat-val" style="color:var(--green)">${matchedCount}</div><div class="stat-lbl">Matched</div></div>
      <div class="stat-box"><div class="stat-val" style="color:var(--red)">${unmatched.length}</div><div class="stat-lbl">Unmatched</div></div>
      <div class="stat-box"><div class="stat-val" style="color:var(--gold)">${state.branches.reduce((a,b)=>a+b.seats,0)-matchedCount}</div><div class="stat-lbl">Seats Unfilled</div></div>
    </div>
    <div class="notice success">âœ“ Stable matching computed. The result is student-optimal and stable.</div>
  ` + state.branches.map(b => {
    const holders = slots[b.id]||[];
    const chips = holders.map(sid=>{
      const s=state.students.find(x=>x.id===sid);
      const rank=(state.prefs[sid]||[]).indexOf(b.id)+1;
      return `<span class="student-chip matched" title="Their preference rank: #${rank}">${s?s.name:sid} <span style="opacity:0.5;font-size:0.7rem">#${rank}</span></span>`;
    }).join('');
    const empties = holders.length<b.seats
      ? Array(b.seats-holders.length).fill(`<span class="student-chip" style="opacity:0.25;border:1px dashed var(--border);color:var(--muted)">Empty seat</span>`).join('') : '';
    return `<div class="result-card">
      <div class="result-header">
        <div><div class="result-college">${b.college}</div><div class="result-branch">${b.branch}</div></div>
        <span class="pill ${holders.length===b.seats?'pill-green':'pill-yellow'}">${holders.length}/${b.seats} filled</span>
      </div>
      <div class="result-students">${chips}${empties}</div>
    </div>`;
  }).join('') + (unmatched.length ? `
    <div class="card">
      <h2>Unmatched Students</h2>
      <p style="font-size:0.83rem;color:var(--muted);margin-bottom:12px">These students exhausted all options or no seats remained.</p>
      <div style="display:flex;flex-wrap:wrap;gap:8px">${unmatched.map(s=>`<span class="student-chip unmatched">${s.name}</span>`).join('')}</div>
    </div>` : '');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STUDENT: PREFERENCES PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let dragSrc=null;

function renderStudentPrefs() {
  if (!session||session.role!=='student') return;
  const sid=session.sid;
  const done=state.submitted[sid];
  const pill=document.getElementById('student-pref-pill');
  if(pill) pill.outerHTML=`<span class="pill ${done?'pill-green':'pill-yellow'}" id="student-pref-pill">${done?'âœ“ Submitted':'Not submitted yet'}</span>`;
  renderStudentPrefList(sid);
}

function renderStudentPrefList(sid) {
  const prefs=state.prefs[sid]||state.branches.map(b=>b.id);
  const pl=document.getElementById('student-pref-list');
  if(!pl)return;
  pl.innerHTML='';
  prefs.forEach((bid,idx)=>{
    const b=state.branches.find(x=>x.id===bid);
    if(!b)return;
    const div=document.createElement('div');
    div.className='pref-row';
    div.draggable=true;
    div.dataset.bid=bid;
    div.innerHTML=`
      <span class="pref-rank">#${idx+1}</span>
      <span class="pref-name">${branchLabel(b)}</span>
      <span class="pill pill-blue">${b.seats} seats</span>
      <span class="drag-handle">â ¿</span>`;
    div.addEventListener('dragstart',e=>{dragSrc=div;div.classList.add('dragging');e.dataTransfer.effectAllowed='move';});
    div.addEventListener('dragend',()=>div.classList.remove('dragging'));
    div.addEventListener('dragover',e=>{e.preventDefault();e.dataTransfer.dropEffect='move';});
    div.addEventListener('drop',e=>{
      e.preventDefault();
      if(dragSrc!==div){
        const kids=[...pl.children];
        const si=kids.indexOf(dragSrc),ti=kids.indexOf(div);
        if(si<ti)pl.insertBefore(dragSrc,div.nextSibling);
        else pl.insertBefore(dragSrc,div);
        updateStudentRanks();
      }
    });
    pl.appendChild(div);
  });
}

function updateStudentRanks(){
  document.querySelectorAll('#student-pref-list .pref-row').forEach((r,i)=>r.querySelector('.pref-rank').textContent=`#${i+1}`);
}

function studentSavePrefs(){
  const sid=session.sid;
  const order=[...document.querySelectorAll('#student-pref-list .pref-row')].map(r=>r.dataset.bid);
  state.prefs[sid]=order;
  state.submitted[sid]=true;
  state.matching=null; // invalidate matching when prefs change
  save();
  const pill=document.getElementById('student-pref-pill');
  if(pill){pill.className='pill pill-green';pill.textContent='âœ“ Submitted';}
  showToast('student-pref-card','Preferences saved and submitted!','success');
}

function studentResetPrefs(){
  const sid=session.sid;
  state.prefs[sid]=state.branches.map(b=>b.id);
  state.submitted[sid]=false;
  save(); renderStudentPrefs();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STUDENT: ALLOTMENT PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderStudentAllotment(){
  if(!session||session.role!=='student')return;
  const sid=session.sid;
  const cont=document.getElementById('student-allotment-content');

  if(!state.matching){
    cont.innerHTML=`
      <div class="allotment-banner pending-banner">
        <div class="allotment-label" style="color:var(--gold)">â³ Matching Pending</div>
        <div class="allotment-college" style="font-size:1.3rem;color:var(--text)">Results not yet published</div>
        <div class="allotment-rank" style="margin-top:8px">The admin has not run the stable matching yet. Check back later.</div>
      </div>
      ${renderStudentPrefSummary(sid)}`;
    return;
  }

  const slots=state.matching.slotHolders;
  let allottedBid=null;
  Object.entries(slots).forEach(([bid,holders])=>{if(holders.includes(sid))allottedBid=bid;});

  if(allottedBid){
    const b=state.branches.find(x=>x.id===allottedBid);
    const prefRank=(state.prefs[sid]||[]).indexOf(allottedBid)+1;
    cont.innerHTML=`
      <div class="allotment-banner matched-banner">
        <div class="allotment-label" style="color:var(--green)">ğŸ‰ Seat Allotted</div>
        <div class="allotment-college">${b.college}</div>
        <div class="allotment-branch">${b.branch}</div>
        <div class="allotment-rank">This was your <strong style="color:var(--gold)">preference #${prefRank}</strong> Â· ${b.seats} total seats in this branch</div>
      </div>
      ${renderStudentPrefSummary(sid)}`;
  } else {
    cont.innerHTML=`
      <div class="allotment-banner unmatched-banner">
        <div class="allotment-label" style="color:var(--red)">âš  No Seat Allotted</div>
        <div class="allotment-college" style="font-size:1.3rem">Unmatched</div>
        <div class="allotment-rank" style="color:var(--muted);margin-top:8px">Unfortunately no seat was available matching your preferences. Please contact the admin.</div>
      </div>
      ${renderStudentPrefSummary(sid)}`;
  }
}

function renderStudentPrefSummary(sid){
  const prefs=state.prefs[sid]||[];
  if(!prefs.length) return '';
  const slots=state.matching?state.matching.slotHolders:{};
  let allottedBid=null;
  if(state.matching) Object.entries(slots).forEach(([bid,h])=>{if(h.includes(sid))allottedBid=bid;});

  const rows=prefs.slice(0,15).map((bid,i)=>{
    const b=state.branches.find(x=>x.id===bid);
    if(!b)return '';
    const isAllotted=allottedBid===bid;
    return `<div class="pref-row" style="cursor:default;${isAllotted?'border-color:var(--green);background:var(--green-dim)':''}">
      <span class="pref-rank">#${i+1}</span>
      <span class="pref-name">${branchLabel(b)}</span>
      ${isAllotted?'<span class="pill pill-green">âœ“ Allotted</span>':'<span class="pill pill-blue">'+b.seats+' seats</span>'}
    </div>`;
  }).join('');

  return `<div class="card">
    <h2>My Preference List</h2>
    <p style="font-size:0.82rem;color:var(--muted);margin-bottom:14px">Showing top 15 of ${prefs.length} preferences</p>
    ${rows}
    ${prefs.length>15?`<p style="font-size:0.8rem;color:var(--muted);margin-top:8px">+${prefs.length-15} more preferences not shown</p>`:''}
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(parentId, msg, type){
  const n=document.createElement('div');
  n.className=`notice ${type}`;
  n.textContent=msg;
  const p=document.getElementById(parentId);
  if(p){p.prepend(n);setTimeout(()=>n.remove(),3000);}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEMO DATA â€” JEE ADVANCED 2025, ALL 23 IITs, 200 STUDENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadDemo(){
  if(!confirm('Load JEE Advanced 2025 demo data?\n\nâ€¢ 200 students (AIR 1â€“200) with real topper names\nâ€¢ 61 branch slots across all 23 IITs\nâ€¢ Preferences reflecting JoSAA 2025 cutoff patterns\n\nThis will replace all current data.'))return;
  state={...state, branches:[], students:[], prefs:{}, submitted:{}, matching:null};

  const branches=[
    {id:'b01',college:'IIT Bombay',branch:'Computer Science & Engg',seats:5},
    {id:'b02',college:'IIT Bombay',branch:'Electrical Engineering',seats:5},
    {id:'b03',college:'IIT Bombay',branch:'Engineering Physics',seats:3},
    {id:'b04',college:'IIT Bombay',branch:'Mechanical Engineering',seats:4},
    {id:'b05',college:'IIT Bombay',branch:'Chemical Engineering',seats:3},
    {id:'b06',college:'IIT Delhi',branch:'Computer Science & Engg',seats:5},
    {id:'b07',college:'IIT Delhi',branch:'Electrical Engineering',seats:5},
    {id:'b08',college:'IIT Delhi',branch:'Mathematics & Computing',seats:4},
    {id:'b09',college:'IIT Delhi',branch:'Mechanical Engineering',seats:4},
    {id:'b10',college:'IIT Delhi',branch:'Chemical Engineering',seats:3},
    {id:'b11',college:'IIT Madras',branch:'Computer Science & Engg',seats:5},
    {id:'b12',college:'IIT Madras',branch:'AI & Data Analytics',seats:4},
    {id:'b13',college:'IIT Madras',branch:'Electrical Engineering',seats:5},
    {id:'b14',college:'IIT Madras',branch:'Mechanical Engineering',seats:4},
    {id:'b15',college:'IIT Kanpur',branch:'Computer Science & Engg',seats:5},
    {id:'b16',college:'IIT Kanpur',branch:'Electrical Engineering',seats:5},
    {id:'b17',college:'IIT Kanpur',branch:'Mathematics & Scientific Computing',seats:4},
    {id:'b18',college:'IIT Kanpur',branch:'Aerospace Engineering',seats:3},
    {id:'b19',college:'IIT Kharagpur',branch:'Computer Science & Engg',seats:5},
    {id:'b20',college:'IIT Kharagpur',branch:'Electronics & Electrical Comm.',seats:5},
    {id:'b21',college:'IIT Kharagpur',branch:'Mechanical Engineering',seats:4},
    {id:'b22',college:'IIT Kharagpur',branch:'Aerospace Engineering',seats:3},
    {id:'b23',college:'IIT Roorkee',branch:'Computer Science & Engg',seats:5},
    {id:'b24',college:'IIT Roorkee',branch:'Electronics & Comm. Engg',seats:5},
    {id:'b25',college:'IIT Roorkee',branch:'Electrical Engineering',seats:4},
    {id:'b26',college:'IIT Roorkee',branch:'Mechanical Engineering',seats:4},
    {id:'b27',college:'IIT Guwahati',branch:'Computer Science & Engg',seats:4},
    {id:'b28',college:'IIT Guwahati',branch:'Electronics & Comm. Engg',seats:4},
    {id:'b29',college:'IIT Guwahati',branch:'Mechanical Engineering',seats:3},
    {id:'b30',college:'IIT Hyderabad',branch:'Computer Science & Engg',seats:4},
    {id:'b31',college:'IIT Hyderabad',branch:'Artificial Intelligence',seats:4},
    {id:'b32',college:'IIT Hyderabad',branch:'Electrical Engineering',seats:3},
    {id:'b33',college:'IIT BHU Varanasi',branch:'Computer Science & Engg',seats:4},
    {id:'b34',college:'IIT BHU Varanasi',branch:'Electronics Engineering',seats:4},
    {id:'b35',college:'IIT BHU Varanasi',branch:'Mechanical Engineering',seats:3},
    {id:'b36',college:'IIT Indore',branch:'Computer Science & Engg',seats:4},
    {id:'b37',college:'IIT Indore',branch:'Electrical Engineering',seats:3},
    {id:'b38',college:'IIT Gandhinagar',branch:'Computer Science & Engg',seats:3},
    {id:'b39',college:'IIT Gandhinagar',branch:'Electrical Engineering',seats:3},
    {id:'b40',college:'IIT Jodhpur',branch:'Computer Science & Engg',seats:3},
    {id:'b41',college:'IIT Jodhpur',branch:'AI & Data Science',seats:3},
    {id:'b42',college:'IIT Mandi',branch:'Computer Science & Engg',seats:3},
    {id:'b43',college:'IIT Mandi',branch:'Electrical Engineering',seats:3},
    {id:'b44',college:'IIT Patna',branch:'Computer Science & Engg',seats:3},
    {id:'b45',college:'IIT Patna',branch:'Electronics & Comm. Engg',seats:3},
    {id:'b46',college:'IIT Tirupati',branch:'Computer Science & Engg',seats:3},
    {id:'b47',college:'IIT Tirupati',branch:'Electrical Engineering',seats:3},
    {id:'b48',college:'IIT Bhubaneswar',branch:'Computer Science & Engg',seats:3},
    {id:'b49',college:'IIT Bhubaneswar',branch:'Electrical Engineering',seats:3},
    {id:'b50',college:'IIT Ropar',branch:'Computer Science & Engg',seats:3},
    {id:'b51',college:'IIT Ropar',branch:'Artificial Intelligence',seats:3},
    {id:'b52',college:'IIT Palakkad',branch:'Computer Science & Engg',seats:3},
    {id:'b53',college:'IIT Palakkad',branch:'Electrical Engineering',seats:2},
    {id:'b54',college:'IIT Dharwad',branch:'Computer Science & Engg',seats:3},
    {id:'b55',college:'IIT Dharwad',branch:'Electrical Engineering',seats:2},
    {id:'b56',college:'IIT Bhilai',branch:'Computer Science & Engg',seats:3},
    {id:'b57',college:'IIT Bhilai',branch:'Electrical Engineering',seats:2},
    {id:'b58',college:'IIT Goa',branch:'Computer Science & Engg',seats:3},
    {id:'b59',college:'IIT Goa',branch:'Mathematics & Computing',seats:2},
    {id:'b60',college:'IIT Jammu',branch:'Computer Science & Engg',seats:3},
    {id:'b61',college:'IIT Jammu',branch:'Electrical Engineering',seats:2},
  ];

  const names=[
    'Rajit Gupta','Saksham Jindal','Majid Mujahid Husain','Parth Mandar',
    'Ujjwal Kesari','Akshat Kumar Chaurasia','Arnav Singh','Devesh Pankaj',
    'Kanishka Chakraborty','Piusa Das','Vipul Garg','Harsh Jha',
    'Shreya Agarwal','Aditya Trivedi','Rishabh Gupta','Devdutta Majhi',
    'Shivam Goyal','Ananya Krishnan','Rahul Khanna','Om Prakash Behera',
    'Sourav Mishra','Daksh Rawat','Vishad Jain','Arjun Pillai',
    'Priya Nair','Rohan Bansal','Karthik Iyer','Sneha Patil',
    'Vivek Sharma','Manav Choudhary','Ishaan Malhotra','Tanya Gupta',
    'Abhishek Verma','Nikhil Reddy','Pooja Yadav','Siddharth Singh',
    'Aarav Patel','Divya Menon','Harshit Agrawal','Lakshmi Narayan',
    'Vaibhav Srivastava','Nandini Kapoor','Aman Kumar','Tushar Bhatt',
    'Ritika Joshi','Mohit Saxena','Ankit Sharma','Sakshi Singh',
    'Gaurav Tiwari','Meera Subramaniam','Pulkit Garg','Aditi Bhatt',
    'Sundar Rajan','Kritika Arora','Dhruv Pandey','Isha Agarwal',
    'Rajesh Nair','Pallavi Reddy','Shubham Jha','Ankita Sharma',
    'Kunal Mehta','Deepika Krishnan','Aditya Rao','Swati Gupta',
    'Pranav Mishra','Ruhi Chauhan','Vikram Thakur','Kavya Menon',
    'Akash Kumar','Riya Jain','Sumit Verma','Preethi Venkatesh',
    'Ayan Bose','Neha Pandey','Tanmay Ghosh','Sanya Kapoor',
    'Himanshu Chaudhary','Lavanya Iyer','Arpit Singh','Diya Nair',
    'Saurabh Gupta','Swara Joshi','Mayank Agarwal','Puja Das',
    'Nitin Tiwari','Shruti Sharma','Venkat Subramanian','Aishwarya Pillai',
    'Rohit Khanna','Simran Kaur','Piyush Bansal','Anjali Rao',
    'Tarun Mehta','Bhavna Singh','Kushal Jain','Nandita Bose',
    'Deepak Sharma','Sonali Trivedi','Akhil Gupta','Pooja Nair',
    'Varun Srivastava','Swathi Reddy','Chirag Patel','Komal Sharma',
    'Ritesh Yadav','Preeti Arora','Sahil Malhotra','Divyani Jha',
    'Kartik Verma','Padmavathi Krishnan','Anmol Singh','Rupal Saxena',
    'Dheeraj Pandey','Vinitha Iyer','Parth Agarwal','Chanchal Gupta',
    'Niraj Tiwari','Keerthi Venkataraman','Shashank Bhatt','Madhuri Nair',
    'Prateek Joshi','Swapna Pillai','Yash Chauhan','Sreeja Menon',
    'Abhinav Thakur','Amrutha Krishnan','Nishant Kumar','Gayatri Rao',
    'Soumya Ghosh','Kavitha Subramaniam','Vishal Mishra','Ramya Iyer',
    'Kiran Bajaj','Sudha Nair','Pankaj Agarwal','Veena Gupta',
    'Raghav Saxena','Lakshmi Devi','Dhruv Malhotra','Shilpa Verma',
    'Ashish Yadav','Meenakshi Pillai','Jatin Sharma','Aparna Bose',
    'Sankalp Jain','Indira Singh','Bhavik Patel','Namitha Nair',
    'Shivraj Singh','Renuka Krishnan','Ronak Mehta','Lavanya Subramaniam',
    'Harish Chandra','Priyanka Yadav','Sameer Khanna','Anjana Pillai',
    'Devraj Jha','Shakuntala Iyer','Farhan Shaikh','Nithya Reddy',
    'Alok Mishra','Sindhu Nair','Rajeev Tiwari','Archana Gupta',
    'Mohd Imran','Shalini Verma','Gyanesh Kumar','Vasudha Sharma',
    'Satish Agarwal','Nithyashri Menon','Rajendra Prasad','Mythri Krishnan',
    'Suresh Babu','Pavithra Rajan','Manish Jaiswal','Sowmya Narayanan',
    'Deepak Nair','Ranjani Suresh','Vikas Choudhary','Malathi Pillai',
    'Suman Pandey','Durga Prasad','Girish Rao','Rekha Sharma',
    'Navin Kumar','Usha Iyer','Pratap Singh','Savitha Reddy',
    'Ravi Shankar','Chitra Menon','Sunil Mehta','Bhagyalakshmi',
    'Ajay Krishnan','Padma Subramaniam','Ramesh Gupta','Geetha Nair',
    'Vikram Reddy','Saranya Pillai','Mohan Lal','Vasantha Kumari',
  ];

  const defaultPass='jee2025';
  const students=names.map((name,i)=>({
    id:'s'+String(i+1).padStart(3,'0'),
    name:`${name} (AIR ${i+1})`,
    password:defaultPass
  }));

  const allBids=branches.map(b=>b.id);
  function bp(top,seed=0){
    let rest=allBids.filter(id=>!top.includes(id));
    if(seed)rest=rest.sort((a,b)=>(a.charCodeAt(3)*(seed+1))%17-(b.charCodeAt(3)*(seed+1))%17);
    return[...top,...rest];
  }

  const prefsMap={};
  students.forEach((s,i)=>{
    const air=i+1;
    const v=air%5;
    let p;
    if(air<=20){
      if(v<4)      p=bp(['b01','b06','b11','b15','b02','b07','b08','b12','b13','b16','b03','b17','b19','b23','b04']);
      else if(v<7) p=bp(['b06','b01','b11','b15','b07','b02','b08','b13','b16','b12','b04','b17','b19','b23','b20']);
      else if(v<11)p=bp(['b11','b06','b15','b01','b12','b13','b07','b08','b16','b02','b17','b19','b23','b04','b14']);
      else if(v<15)p=bp(['b15','b11','b06','b01','b16','b17','b13','b07','b08','b12','b19','b02','b23','b04','b20']);
      else         p=bp(['b01','b06','b11','b15','b19','b02','b07','b13','b16','b08','b12','b17','b23','b03','b04']);
    } else if(air<=66){
      const r=air%5;
      if(r==0)p=bp(['b01','b06','b11','b15','b02','b07','b08','b13','b16','b12','b17','b19','b23','b03','b04'],1);
      else if(r==1)p=bp(['b06','b01','b15','b11','b07','b02','b13','b08','b16','b17','b12','b19','b23','b04','b20'],2);
      else if(r==2)p=bp(['b11','b06','b01','b15','b12','b13','b08','b07','b16','b02','b17','b19','b23','b20','b21'],3);
      else if(r==3)p=bp(['b15','b11','b06','b01','b16','b13','b17','b07','b08','b12','b02','b19','b23','b20','b27'],4);
      else         p=bp(['b06','b11','b15','b01','b07','b08','b12','b02','b13','b16','b17','b19','b23','b27','b20'],5);
    } else if(air<=125){
      const r=air%4;
      if(r==0)p=bp(['b06','b11','b15','b01','b02','b07','b08','b13','b16','b12','b17','b19','b23','b27','b20'],6);
      else if(r==1)p=bp(['b11','b06','b15','b19','b07','b13','b08','b12','b02','b16','b17','b23','b27','b20','b30'],7);
      else if(r==2)p=bp(['b15','b11','b06','b19','b16','b13','b17','b07','b08','b12','b23','b02','b27','b20','b30'],8);
      else         p=bp(['b06','b15','b11','b19','b07','b08','b13','b02','b16','b12','b17','b23','b27','b30','b20'],9);
    } else if(air<=205){
      const r=air%4;
      if(r==0)p=bp(['b11','b15','b19','b06','b12','b13','b16','b07','b08','b17','b23','b27','b30','b20','b33'],10);
      else if(r==1)p=bp(['b15','b11','b19','b23','b16','b17','b13','b12','b07','b08','b27','b30','b20','b33','b36'],11);
      else if(r==2)p=bp(['b19','b15','b11','b23','b20','b21','b16','b13','b17','b12','b27','b30','b33','b36','b24'],12);
      else         p=bp(['b11','b19','b15','b23','b13','b12','b16','b20','b17','b07','b27','b30','b33','b24','b36'],13);
    } else {
      const r=air%5;
      if(r==0)p=bp(['b19','b23','b27','b30','b33','b36','b38','b40','b15','b11','b20','b24','b31','b42','b44'],14);
      else if(r==1)p=bp(['b23','b27','b30','b19','b24','b33','b36','b31','b38','b20','b40','b42','b44','b46','b48'],15);
      else if(r==2)p=bp(['b27','b30','b31','b33','b36','b23','b24','b38','b40','b19','b42','b44','b46','b48','b50'],16);
      else if(r==3)p=bp(['b30','b31','b33','b36','b27','b38','b40','b42','b44','b46','b48','b50','b52','b54','b56'],17);
      else         p=bp(['b33','b36','b38','b40','b42','b44','b46','b48','b50','b52','b54','b56','b58','b60','b61'],18);
    }
    prefsMap[s.id]=p;
  });

  const submitted={};
  students.forEach(s=>submitted[s.id]=true);
  state={...state, branches, students, prefs:prefsMap, submitted, matching:null};
  save(); renderAdmin(); populateStudentSelect();
  alert('âœ… JEE Advanced 2025 demo loaded!\n\nğŸ“Š 200 students â€” password for all: jee2025\nğŸ› 61 slots across all 23 IITs\nâš™ Admin password: admin123\n\nâ¡ Go to "Results" and run the matching!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
populateStudentSelect();
</script>
</body>
</html>
